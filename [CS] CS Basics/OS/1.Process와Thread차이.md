# Process와 Thread의 차이

## 🤷‍♀️ Program과 Process과 Thread의 차이

### # Program

**실행가능한 파일**

실행 가능한(즉 실행되기 이전 상태의) 명령어의 집합. 컴파일된 바이너리 이미지일 수도 있고 파이썬 스크립트 같이 인터프리터 고급어 형태일 수도 있다.

코드 및 정적인 데이터의 묶음



### # Process

메모리에 적재되고 실행되고 있는 **프로그램** (정적인 프로그램과 달리 실제 실행되고 있는 프로그램을 말하기 때문에 동적이라고 표현하기도 함.)

**OS로부터 시스템 자원을 할당받는 작업의 단위**

프로세스를 **프로그램의 인스턴스**라고 표현하기도 하는데 프로그램과 프로세스를 클래스와 인스턴스의 관계로 보면 이해하기 쉽다. 하나의 프로그램을 이용해 여러개의 프로세스를 실행할 수 있기 때문이다. (개념적으로 이해하는 데만 쓰기. 상속같은건 없음.)



각 프로세스는 커널에 의해 직접 관리되는데, 커널 메모리 안에는 각 프로세스를 관리하는 데이터들이 들어있다. 이 정보는 **PCB라고 하는 자료구조** 안에 있는데 커널 스케쥴러가 프로세스를 제어하는 데 필요한 정보들이 담겨 있음.



***⭐ PCB(Process Control Block)***

* 각 프로세스는 OS에서 PCB 자료구조 안에서 표현된다.
* **PID**: 프로세스 아이디
* **프로세스 상태**: new, ready, running, waiting, halted 등..
* **PC** (Program counter): 다음 실행할 명령어의 주소
* **스케쥴링 정보**: 우선 순위 등

![image-20200621223651945](C:\Users\USER\AppData\Roaming\Typora\typora-user-images\image-20200621223651945.png)

윈도우에서 리소스 모니터에 들어가면 다음과 같은 화면을 볼 수 있는데, 여기서 PCB의 몇몇 내용들을 확인할 수 있다. PID, 상태.

하나의 프로세스가 몇 개의 스레드를 사용하고 있는 지도 나타낸다.

실행중이던 **context의 정보는 프로세스가 전환(context switching이 발생)될 때 PCB에 저장**된다. 이후 다시 자기 차례가 왔을 때 PCB에 저장된 상태에서 작업을 재개한다. 아래 그림은 컨텍스트 스위칭이 되는 과정을 설명한다. (시스템콜이나 인터럽트에 의해서 컨텍스트가 변경됨.)

![컨텍스트 스위칭](https://t1.daumcdn.net/cfile/tistory/994590345BB1B4DB2F)



PCB 정보는 커널 메모리 안에서 관리되지만, 일반 메모리 상의 프로세스 정보는 네 가지로 분류할 수 있다.

![OS 프로세스와 스레드의 차이](https://gmlwjd9405.github.io/images/os-process-and-thread/process.png)

위 그림과 같이 Code, Data, Stack, Heap 이렇게 네 영역으로 구분할 수 있다.

* **Code**: 우리가 일반적으로 생각하는 코드
* **Data**: 전역 변수
* **Heap**: 동적 할당 메모리
* **Stack**: 매개변수, 지역변수 등 임시적인 자료. 프로그램이 실행되면서 생겼다 사라지는 값들.



운영체제(OS)는 각 프로세스를 **독립적으로 관리**한다. 그래서 여러 프로세스들끼리 겹칠일이 없고 사용 자원 영역들이 겹쳐서도 안된다. (겹치면 큰 오류 발생!) 다만 한 프로그램에서 여러 프로세스를 실행시킬 때, 코드 영역은 공유한다. 프로세스끼리는 서로 독립적이기 때문에 자원을 공유하기 위해서는 IPC(Interprocess Communication)를 이용해야 한다. => 어쨋든 Context switching 비용이 훨씬 큼 💸💸



### # Thread

**⭐프로세스 내에서 실행되는 흐름⭐**

**동시성**(Concurrency)이 적용된다. (* 동시성: 병렬과 다르게 작업을 아주 작게 쪼개서 순차적으로 실행시킴. 병렬은 동시에 실행시키는 거고 동시성은 순차적으로 실행하는데 거의 동시에 실행되는 것처럼 보이도록 하는 것)

![OS프로세스와 스레드의 차이](https://gmlwjd9405.github.io/images/os-process-and-thread/thread.png)

위 그림과 같이 **하나의 process 내에서 여러 thread들끼리 code, data, heap 영역은 공유. stack과 register는 별도로 가진다**. 한 프로세스에서 두 개 이상의 thread를 가지면 multi thread가 되는 것임.



## 🤷‍♀️ Process와 Thread의 차이

|                           Process                            |                            Thread                            |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| - 프로세스는 실행중인 프로그램을 의미한다.<br />- 프로세스는 종료하는데 시간이 오래 걸린다.<br />- 생성하는데 더 많은 시간이 걸린다.<br />- 컨텍스트 전환에 시간이 더 많이 걸린다.<br />- 커뮤니케이션 측면에서 효율성이 떨어진다.<br />- 쓰레드보다 더 많은 리소스를 사용한다.<br />- 프로세스 간 독립적이다. (자원공유 x)<br />- 프로세스를 heavy weight process라고 한다.<br />- **프로세스 전환은 운영체제의 인터페이스를 사용**한다. | - 스레드는 프로세스의 실행 단위를 의미한다.<br />- 스레드를 종료하는데 시간이 덜 걸린다.<br />- 생성 시간이 덜 걸린다.<br />- 컨텍스트 전환 소요 시간이 줄어든다.<br />- 커뮤니케이션 측면에서 스레드가 더 효율적이다.<br />- 스레드는 적은 자원을 소비한다.<br />- 스레드는 메모리를 공유한다.<br /> - 스레드는 light weight process라고 한다.<br />- **스레드 전환은 OS를 호출할 필요가 없다.** |

위와 같은 차이점들이 있다. 이렇게 보면 process만 엄청 나쁜 것 같지만 thread도 단점이 있다.

### # Thread의 단점

- 주의깊은 설계가 필요하다. (미묘한 시간 차이, 잘못된 변수 공유로 오류 발생할 가능성이 높아진다.)
- 디버깅이 어렵다.
- 멀티 쓰레드의 경우 자원 공유의 문제(동기화 문제)가 발생한다.
- 하나의 쓰레드가 죽으면 프로세스 내 모든 쓰레드가 영향을 받는다.





## Reference

[프로세스와 쓰레드의 차이 - 개발자가 되기위한 첫 걸음 블로그](https://juyoung-1008.tistory.com/47)

[Process와 Thread의 차이 - SUNGHWAN PARK님의 블로그](https://shoark7.github.io/programming/knowledge/difference-between-process-and-thread)

[AI Holic님의 #1 Thread vs Process 컴퓨터공학 기본 강의](https://www.youtube.com/watch?v=RrfASw-jfZ4)

[우아한Tech의 🐳김고래 Process & Thread](https://www.youtube.com/watch?v=LLiV5Yz1AWg&t=43s)