### #1 곱집합과 교차 결합

- 곱집합

곱집합은 합집합이나 교집합처럼 집합의 연산방법중 하나입니다.

두 개의 집합을 곱하는 연산 방법으로 "적집합" 또는 `카디전곱(Cartesian product)` 이라고 불리옵니다. 비슷한 예로 야구팀들과의 대전표를 짠다고 생각하면 됩니다.

예) 집합 X {A,B,C} 집합 Y{1,2,3} 이라는 세개의 요소를 가집니다.

과연 다음 X,Y의 곱집합을 구하게 되면 어떻게 될까요? 즉, 집합 X의 요소 A에 집합 Y의 각 요소를 붙여 계산하는것입니다.

또 다른 예로, 한 시즌에 6화까지 있는 드라마가 3시즌까지 방영되는 경우를 생각해보면 됩니다.

- X(A,B,C) * Y(1,2,3)의 곱집합의 경우

(A,1 A,2 A,3)

(B,1 B,2 B,3)

(C,1 C,2 C,3)

- 교차결합(Cross Join)

데이터베이스의 테이블은 집합의 한종류입니다. 지금까지 select 로만 하나의 테이블로만 지정했습니다. 만약 테이블을 두개 지정하면 이들은 곱집합으로 계산됩니다.

```sql
select *
from 테이블명1, 테이블명2
select *
from sample72_x;

select *
from sample72_y;

select *
from sample72_x, sample_y;
```

교차 결합을 위해서 쉼표(,)로 구분하여 두 테이블을 지정합니다. 야구 대전표처럼 집합이 계산된 것을 확인 할 수 있습니다.

> from 구에 복수의 테이블을 지정하면 교차결합을 한다.

- UNION 연결과 결합 연결의 차이

UNION에서도 집합을 더해 새로 큰 집합을 만들어 계산할 수 있었습니다. 한편으로, FROM 구에서 복수의 테이블을 결합할 때도 새로 큰 집합을 만들어계산합니다. UNION으로 합집합을 구했을 경우에는 세로 방향으로 더해지게 됩니다. 한편, FROM 구로 테이블을 결합할 경우에는 가로 방향으로 더해지게 됩니다.

> 결합은 열(가로)방향으로 확대된다.

즉, UNION은 열 방향으로 확대되고 FROM절로 결합된 것은 행 방향으로 확대된다.

### #2 내부 결합

수학에서의 집합은 유일한 요소이다. 즉, 중복된 값이 존재하지 않는다. 기본키(primary key)를 가지도록 하는게 좋습니다.

데이터베이스에서는 동일한 데이터를 중복해서 여러 곳에 저장하지 않도록하는것이 좋습니다.

예) 상품의 가격이나 이름과 같은 데이터를 저장하는 `상품 테이블` 을 작성할때 상품의 속성으로는 상품명, 메이커명, 가격, 상품분류등을 꼽을 수 있습니다.

하지만, 상품명 보다는 상품코드를 primary key를 사용하는 경우가 많습니다.

상품 테이블의 예)

```sql
CREATE TABLE 상품(
 상품코드 CHAR(4) NOT NULL,
 상품명 VARCHAR(30),
 메이커명 VARCHAR(30),
 가격 INTEGER,
 상품분류 VARCHAR(30),
 PRIMARY KEY(상품코드)
);
```

앞의 예제처럼 테이블을 만들어두면 같은 상품명을 가진 상품이라도 구별하여 등록이 가능합니다.

상품 데이터를 참조하는 별도의 테이블이나 재고도 관리하는 테이블이 그 예입니다.

재고수 테이블 작성하기

```sql
CREATE TABLE 재고수(
	상품코드 CHAR(4),
	입고날짜 DATE,
	재고수 INTEGER
);
```

따로 기본키를 지정하지 않았지만, 재고수 primary  key를 지정하는것이 좋습니다.

상품 테이블의 기본키는 `상품코드` 입니다. 이 열의 값을 알면 상품명을 포함한 상품 데이터를 참조할 수 있습니다. 다른 테이블의 데이터를 참조해야하는 경우, 참조할 테이블의 기본키와 동일한 이름과 자료형으로 열을 만들어서 행을 연결하는 경우가 많다.

→ 상품명으로 표시하면 더욱더 표시하기 더 쉽다.

- 상품 테이블과 재고수 테이블을 교차결합하기

```sql
SELECT * FROM 상품,재고수;
```

- 상품코드가 같은 행을 검색하기

```sql
SELECT * FROM 상품, 재고수
WHERE 상품.상품코드 = 재고수.상품코드;
```

이렇게 교차결합으로 계산된 곱집합에서 원하는 조합을 검색하는 것을 ``내부결합(Inner Join)` 이라 부릅니다.

- 식료품이 같은 조건식

```sql
SELECT 상품.상품명, 재고수.재고수 FROM 상품, 재고수
WHERE 상품.상품코드 = 재고수.상품코드
AND 상품.상품분류 = '식료품';
```

### #3. INNER JOIN으로 내부결합하기

- FROM 구에 테이블을 복수 지정해 가로 방향으로 테이블을 결합할 수 있습니다.
- 교차 결합하면 곱집합으로 계산합니다.
- WHERE 조건을 지정해 곱집합에서 필요한 조합만 검색할 수 있다.
- INNER JOIN 키워드를 사용한다.

```sql
SELECT 상품.상품명, 재고수.재고수
FROM 상품 INNER JOIN 재고수
ON 상품.상품코드 = 재고수.상품코드
WHERE 상품.상품분류 = '식료품';
```

구식방법: 쉼표(,)로 구분하여 테이블을 FROM 구에 지정했습니다. 새로운 형식에서는 테이블과 테이블사이에 `INNER JOIN` 키워드를 넣습니다. 즉, INNER JOIN은 내부결합의 의미가 됩니다. 구식 방법에서는 WHERE 구에 결합조건을 지정하였지만 INNER JOIN에서는 ON을 사용하여 결합조건을 지정합니다.

> INNER JOIN으로 두 개 테이블을 가로로 결합할 수 있다.

### #4 내부결합을 활용한 데이터 관리

메이커코드는 메이커를 나타내는 코드라는 의미에서 맨 앞자를 M으로 하였습니다.

- 메이커 테이블 작

```sql
CREATE TABLE 메이커(
	메이커코드 CHAR(4) NOT NULL,
	메이커명 VARCHAR(30),
	PRIMARY KEY(메이커코드)
```

상품 테이블에서는 메이커명을 메이커코드로 변경해둡니다.

상품코드나 상품명처럼 메이커코드와 상품명으로 열을 지장하고 상품코드로 기본키가 되는 패턴은 자주나오는 패턴입니다.

- 상품테이블과 메이커 테이블을 내부 결합하기

```sql
SELECT S.상품명, M.메이커명
FROM 상품2 S INNER JOIN 메이커 M
ON S.메이커코드 = M.메이커코드;
```

SELECT 명령에서 복수의 테이블을 다룰 경우 어느 테이블의 열인지 정확하게 지정해야 합니다.

상품테이블의 메이커코드만을 살펴보면 중복되는 행이 있습니다.  단, 기본키 제약은 상품코드에만 적용되어 있어 데이터상으로 제약이 위반되어 않습니다. 반대로 메이커 테이블은 메이커코드에 기본키가 지정되어 있기 때문에 중복을 허용하지 않습니다. 메이커코드는 유일하게 하나씩만 존재하며 중복될 수 없습니다. 존재하지 않거나 혹은 하나만 존재합니다.

A,B테이블 결합시 서로 결합하는 테이블간의 관계가 중요합니다.

- 외부키

메이커 테이블의 메이커코드는 기본키입니다. 그에 비해 상품 테이블의 메이커코드는 외부키라 불리는 것으로, 다른 테이블의 기본키를 참조하는 열이 외부키가 됩니다.

- 자기결합(Self Join)

자기 결합은 테이블에 별명을 붙일 수 있는 기능을 이용해 같은 테이블끼리 결합하는것을 말합니다. 특별히 명령어가 정해져 있는 것은 아닙니다.

```sql
SELECT S1.상품명, S2.상품명
FROM 상품 S1 INNER JOIN 상품 S2
ON S1.상품코드 =  S2.상품코드
```

상품 테이블을 가로로 두 개 나열해 상품코드로 연결했습니다. 자기 결합에서는 결합의 좌우가 같은 테이블이 되기 때문에 이를 구별하기 위해서 반드시 별명을 붙여야합니다.

자기 결합은 자기 자신의 기본키를 참조하는 열을 자기 자신이 가지는 데이터 구조로 되어 있을 경우에 자주 사용됩니다.

### #5 외부 결합

결합 방식은 내부 결합과 외부 결합 두가지 방식으로  이루어져 있습니다.

외부 결합이라고 해도 교차결합으로 결합 조건을 지정하여 검색한다는 기본적인 사고방식은 같습니다.

- 외부 결합이란?

어느 한 쪽에만 존재하는 데이터행을 어떻게 다룰지 변경할 수 있는 결합 방법입니다.

상품3 테이블에 상품코드 0009인 행을 추가하고 재고수 테이블에는 아직 이 상품에 대한 데이터가 없습니다.

이런 상태에도 곱집합을 구해도 0009 = 0009가 되는 행은 존재하지 않으므로 내부결합 과정에서 상품코드가 0009인 상품이 제외됩니다.

- 내부결합에서는 상품코드가 0009인 상품이 제외된다.

```sql
SELECT 상품3.상품명, 재고수.재고수
FROM 상품3 INNER JOIN 재고수
ON 상품3.상품코드 = 재고수.상품코드
WHERE 상품3.상품분류 = '식료품';
```

이렇게 내부결합의 결과에 0009는 없을 경우 외부결합을 사용하면 됩니다. 외부 결합은 결합하는 테이블 중에 어느 쪽을 기준으로 할지 결정할 수 있습니다.

상품 테이블(결합의 왼쪽)을 기준으로 INNER JOIN 대신 LEFT JOIN을 사용해보갰습니다.

```sql
SELECT 상품3.상품명, 재고수.재고수
FROM 상품3 LEFT JOIN 재고수
ON 상품3.상품코드 = 재고수.상품코드
WHERE 상품3.상품분류 = '식료품';
```

재고수 테이블에는 0009에 대한 데이터가 없으므로 값이 NULL로 표시되는점을 주의하시면 됩니다. 기준이 되는 상품테이블을 JOIN의 왼쪽에 기술했으므로 `LEFT JOIN` 이라 지정합니다. 상품테이블을 쩡하는 경우나 재고 테이블 기준으로 삼고 싶은 경우에는 `RIGHT JOIN` 을 사용해 외부 결합을 시행합니다.

> LEFT JOIN, RIGHT JOIN으로 외부결합을 할 수 있다.

- 구식방법에서의 외부결합과 표준 SQL

Oracle기준

구식방법에서는 FROM구에 결합 조건을 기술하지 않습니다. 대신 WHERE구로 결합 조건을 지정합니다. 그냥 조건식을 지정하면 내부결합이 되어버리므로, 외부결합으로 진행하고 싶은 경우에는 특별한 연산자를 사용합니다.

Oracle에서는 데이터가 존재하지 않을 수도 있는 테이블의 열에(+)라는 특수한 기호를 붙여서 조건식을 지정합니다.

- Oracle에서 구식 외부 결합으로 0009의 상품을 결과에 포함하기

```sql
SELECT 상품3.상품명, 재고수.재고수
FROM 상품3, 재고수
WHERE 상품3.상품코드 = 재고수.상품코드 (+)
AND 상품3.상품분류 = '식료품';
```

즉, SQL 방언과 같은 느낌으로 그 밖에도 SQL Server 특수한 연산자(*= or =*) 외부결합 지원을 합니다.

현재는 표준화로 인해 내부 결합은 INNER JOIN, 외부 결합은 LEFT JOIN이나 RIGHT JOIN을 사용하도록 권장합니다.

> 구식 결합방법은 사용하지 않는다.