# 8강 데이터베이스 설계
## 36강 트랜잭션

```mysql
START TRANSACTION
COMMIT
ROLLBACK
```

1. 트랜잭션
    테이블명 : 주문
    |주문번호|날짜|고객번호|
    |-|-|-|
    |1|1/1|1|
    |2|2/1|2|
    |3|2/5|1|
    
    
    테이블명 : 주문상품
    |주문번호|상품코드|개수|
    |-|-|-|
    |1|0001|1|
    |1|0002|2|
    |1|0002|2|
    |1|0003|3|
    |3|0001|3|
    |3|0003|1|
    
    - 서로 의존관계이다.
    
    - 발주처리
    ```mysql
    INSERT INTO 주문 VALUES(4,'2014-03-01',1);
    INSERT INTO 주문상품 VALUES(4,'0003',1);
    INSERT INTO 주문상품 VALUES(4,'0004',2);
    ```
    - 만약 3번째 INSERT를 명령에서 에러가 발생한다면?
    - 트랜젝션이 사용되지 않는 상태에서는 DELETE명령으로 지워야한다.
    - 하지만 이 작업은 번거로운 작업이다.
1. 롤백과 커밋
    - 롤백: 트랜잭션을 사용해서 데이터를 추가한다면 에러가 발생해도 트랜잭션을 종료시킬 수 있다.
    - 커밋 : 에러가 발생하지 않는다면 변경사항을 적용하고 트랜잭션을 종료한다.
    
    - 자동 커밋
    
       트랜잭션 시작
       ```mysql
       START TRNSACTION
       ```
       
       트랜잭션 내에서 실행한 명령을 **적용**한 후 종료
       ```mysql
       COMMIT
       ```
       
       트랜젝션 내에서 실행한 명령을 **파기**한 후 종료
       ```mysql
       ROLLBACK
       ```
       
    - 트랜잭션을 사용해서 처리하는 것으로 간단히 데이터를 관리 할 수 있다.
    
1. 트랜잭션 사용법    
    - 트랜잭션 내에서 실행되는 복수의 SQL 명령은 세트 단위로 유효/무효된다.
    - 세트로 실행하고 싶은 SQL명령을 트랜잭션에서 하나로 묶어서 실행할 수 있다.
    - 표준화가 진행되지 못했다.
        - SQL Server, PostgreSQL : BEGIN TRANSACTION
        - Mysql : START TRANSACTION, BEGIN
        - Oracle, DB2 : 트랜잭션을 실행하는 명령어가 없다.
    - 자동커밋은 클라이언트 툴기능
    - 미들웨어도 데이터베이스 접속 시 대개 자동 커밋을 한다.
    - 데이터베이스 서버에서는 언제나 트랜잭션을 걸 수 있는 상태로 SQL명령이 실행된다.
    - 트랜잭션을 사용할 경우, 접속 형태나 클라이언트 툴의 자동 커밋 사용 등 트랜잭션 관련 기능을 파악해 둘 필요가 있다
    
    
참고
  - [자동 커밋 모드](https://docs.microsoft.com/ko-kr/sql/odbc/reference/develop-app/auto-commit-mode?view=sql-server-ver15)
  - [오라클](https://mine-it-record.tistory.com/86)
